class MedicalBrain:
    def __init__(self):
        # זהו הלב של המערכת - מיפוי משמעויות
        # המבנה: { "קטגוריה_בטופס": { "מושג_רפואי": [רשימת_מילים_נרדפות] } }
        
        self.knowledge_base = {
            # --- היסטוריה רפואית (GH) ---
            "general_health": {
                "סוכרת": ["סוכרת", "סוכר גבוה", "אינסולין", "גלוקוז", "מטפורמין"],
                "יתר לחץ דם": ["לחץ דם", "ל״ד", "יתר ל.ד", "כדורים ללב"],
                "בעיות לב": ["התקף לב", "צנתור", "קוצב", "הפרעות קצב"],
                "ניתוחים": ["ניתוח", "קיסרי", "אפנדציט", "החלפת מפרק"],
                "אוסטיאופורוזיס": ["בריחת סידן", "צפיפות עצם", "עצמות חלשות"]
            },
            
            # --- תלונת המטופל (HPC) ---
            "hpc": {
                "טראומה/חבלה": ["נפלתי", "מכה", "תאונה", "החלקתי", "חבלה", "בום"],
                "התפרצות": ["התחיל פתאום", "התעוררתי עם זה", "אחרי אימון", "סחבתי משהו"],
                "כרוני": ["כבר הרבה זמן", "שנים", "בא והולך", "ישן"]
            },
            
            # --- גורמים מחמירים (Aggravating) ---
            "aggravating": {
                "תנועה": ["הליכה", "ללכת", "ריצה", "זז", "תזוזה"],
                "מנח סטטי": ["עמידה", "ישיבה", "לעמוד", "לשבת"],
                "עומס": ["להרים", "משקל", "סחיבה", "מאמץ", "מדרגות"],
                "שינה": ["שכיבה", "בלילה", "במיטה"]
            },
            
            # --- גורמים מקלים (Easing) ---
            "easing": {
                "מנוחה": ["לנוח", "שוכב", "לא זז", "יושב"],
                "טיפול עצמי": ["מקלחת", "מים חמים", "קרח", "חימום", "מסאז"],
                "תרופתי": ["כדור", "משחה", "זריקה"]
            }
        }

    def analyze(self, text):
        # 1. ניקוי הטקסט
        clean_text = text.replace(",", "").replace(".", "").lower()
        words = clean_text.split()
        
        # תוצאות ריקות שיתמלאו
        findings = {
            "general_health": [],
            "hpc": [],
            "aggravating": [],
            "easing": []
        }
        
        # 2. הסריקה החכמה
        # עוברים על כל הקטגוריות במוח
        for category, concepts in self.knowledge_base.items():
            # עוברים על כל מושג רפואי (למשל 'סוכרת')
            for medical_term, synonyms in concepts.items():
                # בודקים אם אחת המילים הנרדפות מופיעה בטקסט של המטופל
                for synonym in synonyms:
                    if synonym in clean_text:
                        # בינגו! מצאנו התאמה.
                        # במקום לכתוב סתם את המילה שנאמרה ("סוכר"), נכתוב את המושג הרפואי ("סוכרת")
                        findings[category].append(medical_term)
                        break # מפסיקים לחפש את אותו מושג כדי לא לכתוב פעמיים
        
        # 3. ניקוי ועיצוב התוצאות
        final_output = {}
        for cat, results_list in findings.items():
            if results_list:
                final_output[cat] = ", ".join(results_list)
            else:
                final_output[cat] = ""
                
        return final_output

# --- בדיקת המערכת (זה רץ רק כשמפעילים את הקובץ הזה לבד) ---
if __name__ == "__main__":
    brain = MedicalBrain()
    
    # סימולציה של משפט מטופל
    patient_text = "אני סובל כבר שנים מלחץ דם וקצת סוכר גבוה. אתמול נפלתי במדרגות והכאב מתגבר כשאני מנסה ללכת, אבל עוזר לי לשים קרח."
    
    print("משפט המטופל:", patient_text)
    print("\n--- ניתוח ה-AI ---")
    result = brain.analyze(patient_text)
    
    print(f"היסטוריה רפואית: {result['general_health']}")
    print(f"תלונת המקרה (HPC): {result['hpc']}")
    print(f"מחמיר: {result['aggravating']}")
    print(f"מקל: {result['easing']}")